<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HVAC Wiring ‚Äî Interactive Network Editor</title>
<style>
:root{
  --bg:#0b1220; --card:#0f1830; --ink:#e8eefc; --muted:#9bb0d6; --accent:#7aa2ff; --good:#6ee7a1; --warn:#fcd34d; --bad:#fca5a5;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}
.container{max-width:1600px;margin:0 auto;padding:32px}
.card{background:var(--card);border:1px solid #223;border-radius:16px;padding:20px;margin:16px 0;box-shadow:0 8px 40px rgba(0,0,0,.35)}
h1{font-size:28px;margin:.2em 0 0.2em}
h2{font-size:22px;margin:1.2em 0 .4em}
.note{color:var(--muted)}
.btn{display:inline-block;background:var(--accent);color:#081020;padding:10px 14px;border-radius:10px;font-weight:600;margin-right:8px}
.controls{
  margin:10px 0;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.controls button{
  background:var(--card);
  color:var(--ink);
  border:1px solid #223;
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}
.controls button:hover{
  background:var(--accent);
  color:#081020;
}
#root {
  width: 100%;
  height: 850px;
  background: #0b1328;
  border: 1px solid #223;
  border-radius: 12px;
  transition: opacity 0.3s ease;
}

.legend{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
  margin:15px 0;
}
.legend-item{
  display:flex;
  align-items:center;
  gap:8px;
  background:#0b1328;
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #223;
}
.legend-color{
  width:30px;
  height:3px;
  border-radius:2px;
}
.legend-color.dashed{
  background:repeating-linear-gradient(90deg,var(--color) 0,var(--color) 5px,transparent 5px,transparent 10px);
}
</style>
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<style>
#root .vis-network {
  background: #0b1328 !important;
}
#root .vis-network canvas {
  background: #0b1328 !important;
}
</style>
</head>
<body>
<div class="container">
  <h1>HVAC Wiring ‚Äî Interactive Network Editor</h1>
  
  <div class="card">
    <h2>Full System Schematic (vis-network)</h2>
    <p class="note">Drag nodes to reposition, zoom with mouse wheel, pan by dragging canvas. Interactive physics-based network with smooth edges.</p>
    <div class="controls">
      <button id="exportBtn">üíæ Export Layout JSON</button>
      <button id="fitViewBtn">üîç Fit View</button>
      <button id="highlightDehumid">Trace Dehumidify Signal</button>
      <button id="highlightCooling">Trace Cooling Call</button>
      <button id="highlightHeating">Trace Heating Call</button>
      <button id="highlightPower">Show Power Distribution</button>
      <button id="resetBtn">Reset Highlight</button>
    </div>
    <div id="root"></div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="--color:#7aa2ff;background:#7aa2ff;"></div>
        <span>24VAC Hot (R)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#6ee7a1;background:#6ee7a1;"></div>
        <span>24VAC Common (C)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color dashed" style="--color:#6ee7a1;"></div>
        <span>Dry Contact (D1/D2)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#fcd34d;background:#fcd34d;"></div>
        <span>Control Signal</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#fca5a5;background:#fca5a5;"></div>
        <span>Damper Control</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#9bb0d6;background:#9bb0d6;"></div>
        <span>HVAC Calls (Y1/W1/G/O)</span>
      </div>
    </div>
  </div>

  <p><a class="btn" href="index.html">Back</a> <a class="btn" href="wiring-simple-d3.html">View D3.js Version</a></p>
</div>

<script>

// vis-network configuration
const nodeColors = {
  transformer: '#9bb0d6',
  panel: '#7aa2ff',
  thermostat: '#6ee7a1',
  relay: '#9bb0d6',
  dehumidifier: '#fcd34d',
  damper: '#fca5a5',
  equipment: '#9bb0d6'
};

const edgeColors = {
  hot: '#7aa2ff',
  common: '#6ee7a1',
  signal: '#fcd34d',
  'dry-contact': '#6ee7a1',
  damper: '#fca5a5'
};

// Create nodes
const nodes = new vis.DataSet([
  {
    id: 'transformer',
    label: '24VAC Transformer\n(UPS-backed)',
    x: 88.66,
    y: -124.50,
    group: 'transformer',
    color: { background: nodeColors.transformer, border: '#314', highlight: { background: '#b0c4e6', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true, multi: 'html' },
    shape: 'box',
    margin: 10
  },
  {
    id: 'panel',
    label: 'BMPLUS-3000\nZone Panel',
    x: 589.71,
    y: 200.89,
    group: 'panel',
    color: { background: nodeColors.panel, border: '#314', highlight: { background: '#9ab2ff', border: '#314' } },
    font: { color: '#081020', size: 14, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 15,
    widthConstraint: { minimum: 240 }
  },
  {
    id: 'ecobeeZ1',
    label: 'Ecobee Z1\n(Enhanced)',
    x: 1182.93,
    y: 30.60,
    group: 'thermostat',
    color: { background: nodeColors.thermostat, border: '#314', highlight: { background: '#8ef7c1', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 10
  },
  {
    id: 'ecobeeZ2',
    label: 'Ecobee Z2\n(Premium)',
    x: 258.20,
    y: 423.58,
    group: 'thermostat',
    color: { background: nodeColors.thermostat, border: '#314', highlight: { background: '#8ef7c1', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 10
  },
  {
    id: 'relay',
    label: 'RIBU1C\nRelay',
    x: 807.16,
    y: 517.62,
    group: 'relay',
    color: { background: nodeColors.relay, border: '#314', highlight: { background: '#b0c4e6', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 10
  },
  {
    id: 'dehumidifier',
    label: 'GeneralAire\nDehumidifier',
    x: 1227.93,
    y: 515.53,
    group: 'dehumidifier',
    color: { background: nodeColors.dehumidifier, border: '#314', highlight: { background: '#fde68d', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 10
  },
  {
    id: 'damper1',
    label: 'Zone 1 Damper\n(First Floor)',
    x: 608.66,
    y: -67.03,
    group: 'damper',
    color: { background: nodeColors.damper, border: '#314', highlight: { background: '#fcb5b5', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 10
  },
  {
    id: 'damper2',
    label: 'Zone 2 Damper\n(Basement)',
    x: 708.66,
    y: 657.48,
    group: 'damper',
    color: { background: nodeColors.damper, border: '#314', highlight: { background: '#fcb5b5', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 10
  },
  {
    id: 'equipment',
    label: 'HVAC Equipment\n(Rheem RP14 + Aux)',
    x: 969.85,
    y: 631.24,
    group: 'equipment',
    color: { background: nodeColors.equipment, border: '#314', highlight: { background: '#b0c4e6', border: '#314' } },
    font: { color: '#081020', size: 13, face: 'system-ui', bold: true },
    shape: 'box',
    margin: 15
  }
]);

// Define edges (connections) for vis-network
const edges = new vis.DataSet([
  // Power distribution
  { id: 'e1', from: 'transformer', to: 'panel', label: 'R (24VAC)', color: { color: edgeColors.hot }, width: 3, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'hot', group: 'power', smooth: { type: 'cubicBezier' } },
  { id: 'e2', from: 'transformer', to: 'panel', label: 'C', color: { color: edgeColors.common }, width: 3, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'common', group: 'power', smooth: { type: 'cubicBezier' } },
  { id: 'e3', from: 'transformer', to: 'ecobeeZ1', label: 'R', color: { color: edgeColors.hot }, width: 3, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'hot', group: 'power', smooth: { type: 'cubicBezier' } },
  { id: 'e4', from: 'transformer', to: 'ecobeeZ1', label: 'C', color: { color: edgeColors.common }, width: 3, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'common', group: 'power', smooth: { type: 'cubicBezier' } },
  { id: 'e5', from: 'transformer', to: 'ecobeeZ2', label: 'R', color: { color: edgeColors.hot }, width: 3, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'hot', group: 'power', smooth: { type: 'cubicBezier' } },
  { id: 'e6', from: 'transformer', to: 'ecobeeZ2', label: 'C', color: { color: edgeColors.common }, width: 3, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'common', group: 'power', smooth: { type: 'cubicBezier' } },
  
  // Ecobee HVAC calls
  { id: 'e7', from: 'ecobeeZ1', to: 'panel', label: 'Y1', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'cooling', smooth: { type: 'cubicBezier' } },
  { id: 'e8', from: 'ecobeeZ1', to: 'panel', label: 'W1', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'heating', smooth: { type: 'cubicBezier' } },
  { id: 'e9', from: 'ecobeeZ2', to: 'panel', label: 'Y1', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'cooling', smooth: { type: 'cubicBezier' } },
  { id: 'e10', from: 'ecobeeZ2', to: 'panel', label: 'W1', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'heating', smooth: { type: 'cubicBezier' } },
  
  // Panel to equipment
  { id: 'e11', from: 'panel', to: 'equipment', label: 'Y1', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'cooling', smooth: { type: 'cubicBezier' } },
  { id: 'e12', from: 'panel', to: 'equipment', label: 'W1', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'heating', smooth: { type: 'cubicBezier' } },
  { id: 'e13', from: 'panel', to: 'equipment', label: 'G', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'cooling', smooth: { type: 'cubicBezier' } },
  { id: 'e14', from: 'panel', to: 'equipment', label: 'O', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'cooling', smooth: { type: 'cubicBezier' } },
  
  // Dehumidify path
  { id: 'e15', from: 'ecobeeZ2', to: 'relay', label: 'ACC+', color: { color: edgeColors.signal }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'signal', group: 'dehumidify', smooth: { type: 'cubicBezier' } },
  { id: 'e16', from: 'panel', to: 'relay', label: 'C', color: { color: edgeColors.common }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'common', group: 'dehumidify', smooth: { type: 'cubicBezier' } },
  { id: 'e17', from: 'relay', to: 'dehumidifier', label: 'D1', color: { color: edgeColors['dry-contact'] }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'dry-contact', group: 'dehumidify', dashes: [5, 5], smooth: { type: 'cubicBezier' } },
  { id: 'e18', from: 'relay', to: 'dehumidifier', label: 'D2', color: { color: edgeColors['dry-contact'] }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'dry-contact', group: 'dehumidify', dashes: [5, 5], smooth: { type: 'cubicBezier' } },
  
  // Zone damper control
  { id: 'e19', from: 'panel', to: 'damper1', label: 'M1', color: { color: edgeColors.damper }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'damper', group: 'zone1', smooth: { type: 'cubicBezier' } },
  { id: 'e20', from: 'panel', to: 'damper1', label: 'M4', color: { color: edgeColors.damper }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'damper', group: 'zone1', smooth: { type: 'cubicBezier' } },
  { id: 'e21', from: 'panel', to: 'damper1', label: 'M6', color: { color: edgeColors.damper }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'damper', group: 'zone1', smooth: { type: 'cubicBezier' } },
  { id: 'e22', from: 'panel', to: 'damper2', label: 'M1', color: { color: edgeColors.damper }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'damper', group: 'zone2', smooth: { type: 'cubicBezier' } },
  { id: 'e23', from: 'panel', to: 'damper2', label: 'M4', color: { color: edgeColors.damper }, width: 2.5, font: { color: '#e8eefc', size: 10, bold: true }, wireType: 'damper', group: 'zone2', smooth: { type: 'cubicBezier' } }
]);

// vis-network configuration options
const options = {
  layout: {
    improvedLayout: false
  },
  physics: {
    enabled: false
  },
  interaction: {
    dragNodes: true,
    dragView: true,
    zoomView: true,
    tooltipDelay: 100
  },
  nodes: {
    chosen: {
      node: function(values, id, selected, hovering) {
        if (selected || hovering) {
          values.borderWidth = 2;
          values.borderColor = '#7aa2ff';
        }
      }
    }
  },
  edges: {
    chosen: {
      edge: function(values, id, selected, hovering) {
        if (selected || hovering) {
          values.width = values.width * 1.5;
        }
      }
    }
  }
};

// Store original edge data for reset
const originalEdgesData = edges.get();

// Initialize the network
let network = null;

// Export layout function
window.exportLayout = function() {
  const positions = network.getPositions();
  const layout = {
    components: {},
    edges: originalEdgesData.map(e => ({
      from: e.from,
      to: e.to,
      type: e.wireType,
      group: e.group,
      label: e.label
    }))
  };
  
  nodes.forEach(node => {
    const pos = positions[node.id] || { x: node.x, y: node.y };
    layout.components[node.id] = {
      x: pos.x,
      y: pos.y,
      type: node.group,
      label: node.label
    };
  });
  
  const json = JSON.stringify(layout, null, 2);
  
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'hvac-visnetwork-layout.json';
  a.click();
  URL.revokeObjectURL(url);
  
  console.log("=== vis-network Layout ===");
  console.log(json);
  alert("Layout exported! Check downloads and console.");
};

// Fit view function
window.fitView = function() {
  if (network) {
    network.fit({
      animation: {
        duration: 500,
        easingFunction: 'easeInOutQuad'
      }
    });
  }
};

// Highlight path function
window.highlightPath = function(group) {
  const edgesData = edges.get();
  const relevantNodes = new Set();
  
  // Update edges
  edgesData.forEach(edge => {
    if (edge.group === group) {
      relevantNodes.add(edge.from);
      relevantNodes.add(edge.to);
      edges.update({
        id: edge.id,
        width: 5,
        color: { color: '#fcd34d' }
      });
    } else {
      edges.update({
        id: edge.id,
        opacity: 0.2,
        color: { 
          color: edge.color.color,
          opacity: 0.2
        }
      });
    }
  });
  
  // Update nodes
  const nodesData = nodes.get();
  nodesData.forEach(node => {
    if (!relevantNodes.has(node.id)) {
      nodes.update({
        id: node.id,
        opacity: 0.3
      });
    }
  });
};

// Reset highlight function
window.resetHighlight = function() {
  // Reset edges to original data
  edges.clear();
  edges.add(originalEdgesData);
  
  // Reset nodes opacity
  const nodesData = nodes.get();
  nodesData.forEach(node => {
    nodes.update({
      id: node.id,
      opacity: 1.0
    });
  });
};

// Setup button handlers and initialize network
document.addEventListener('DOMContentLoaded', () => {
  const container = document.getElementById('root');
  
  // Initialize network
  network = new vis.Network(container, { nodes: nodes, edges: edges }, options);
  
  // Fit view after initialization
  network.once('stabilizationIterationsDone', function() {
    network.fit();
  });
  
  // Add stabilization start/end event handlers to prevent flickering
  network.on('stabilizationProgress', function(params) {
    const widthFactor = params.iterations/params.total;
    container.style.opacity = Math.max(0.3, widthFactor);
  });
  
  network.on('stabilizationIterationsDone', function() {
    container.style.opacity = 1.0;
  });
  
  // Setup button handlers
  document.getElementById('exportBtn').addEventListener('click', window.exportLayout);
  document.getElementById('fitViewBtn').addEventListener('click', window.fitView);
  document.getElementById('highlightDehumid').addEventListener('click', () => window.highlightPath('dehumidify'));
  document.getElementById('highlightCooling').addEventListener('click', () => window.highlightPath('cooling'));
  document.getElementById('highlightHeating').addEventListener('click', () => window.highlightPath('heating'));
  document.getElementById('highlightPower').addEventListener('click', () => window.highlightPath('power'));
  document.getElementById('resetBtn').addEventListener('click', window.resetHighlight);
});
</script>
</body>
</html>
