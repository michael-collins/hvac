<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HVAC Wiring ‚Äî Interactive Network Editor</title>
<style>
:root{
  --bg:#0b1220; --card:#0f1830; --ink:#e8eefc; --muted:#9bb0d6; --accent:#7aa2ff; --good:#6ee7a1; --warn:#fcd34d; --bad:#fca5a5;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}
.container{max-width:1600px;margin:0 auto;padding:32px}
.card{background:var(--card);border:1px solid #223;border-radius:16px;padding:20px;margin:16px 0;box-shadow:0 8px 40px rgba(0,0,0,.35)}
h1{font-size:28px;margin:.2em 0 0.2em}
h2{font-size:22px;margin:1.2em 0 .4em}
.note{color:var(--muted)}
.btn{display:inline-block;background:var(--accent);color:#081020;padding:10px 14px;border-radius:10px;font-weight:600;margin-right:8px}
.controls{
  margin:10px 0;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.controls button{
  background:var(--card);
  color:var(--ink);
  border:1px solid #223;
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}
.controls button:hover{
  background:var(--accent);
  color:#081020;
}
#root {
  width: 100%;
  height: 850px;
  background: #0b1328;
  border: 1px solid #223;
  border-radius: 12px;
}

/* React Flow overrides for dark theme */
.react-flow__node {
  font-size: 13px;
  font-weight: bold;
}

.react-flow__edge-path {
  stroke-width: 3;
}

.react-flow__edge-text {
  font-size: 10px;
  fill: #e8eefc;
}

.react-flow__controls {
  background: var(--card);
  border: 1px solid #223;
}

.react-flow__controls button {
  background: var(--card);
  border-bottom: 1px solid #223;
  color: var(--ink);
}

.react-flow__controls button:hover {
  background: var(--accent);
  color: #081020;
}

.react-flow__minimap {
  background: var(--card);
  border: 1px solid #223;
}

.react-flow__background {
  background: #0b1328;
}

.legend{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
  margin:15px 0;
}
.legend-item{
  display:flex;
  align-items:center;
  gap:8px;
  background:#0b1328;
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #223;
}
.legend-color{
  width:30px;
  height:3px;
  border-radius:2px;
}
.legend-color.dashed{
  background:repeating-linear-gradient(90deg,var(--color) 0,var(--color) 5px,transparent 5px,transparent 10px);
</style>
</head>
<body>
<div class="container">
  <h1>HVAC Wiring ‚Äî Interactive Network Editor</h1>
  
  <div class="card">
    <h2>Full System Schematic (vis-network)</h2>
    <p class="note">Drag nodes to reposition, zoom with mouse wheel, pan by dragging canvas. Interactive physics-based network with smooth edges.</p>
    <div class="controls">
      <button id="exportBtn">üíæ Export Layout JSON</button>
      <button id="fitViewBtn">üîç Fit View</button>
      <button id="highlightDehumid">Trace Dehumidify Signal</button>
      <button id="highlightCooling">Trace Cooling Call</button>
      <button id="highlightHeating">Trace Heating Call</button>
      <button id="highlightPower">Show Power Distribution</button>
      <button id="resetBtn">Reset Highlight</button>
    </div>
    <div id="root"></div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="--color:#7aa2ff;background:#7aa2ff;"></div>
        <span>24VAC Hot (R)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#6ee7a1;background:#6ee7a1;"></div>
        <span>24VAC Common (C)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color dashed" style="--color:#6ee7a1;"></div>
        <span>Dry Contact (D1/D2)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#fcd34d;background:#fcd34d;"></div>
        <span>Control Signal</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#fca5a5;background:#fca5a5;"></div>
        <span>Damper Control</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="--color:#9bb0d6;background:#9bb0d6;"></div>
        <span>HVAC Calls (Y1/W1/G/O)</span>
      </div>
    </div>
  </div>

  <p><a class="btn" href="index.html">Back</a> <a class="btn" href="wiring-simple-d3.html">View D3.js Version</a></p>
</div>

<script>

// Node and edge data
const nodeColors = {
  transformer: '#9bb0d6',
  panel: '#7aa2ff',
  thermostat: '#6ee7a1',
  relay: '#9bb0d6',
  dehumidifier: '#fcd34d',
  damper: '#fca5a5',
  equipment: '#9bb0d6'
};

const edgeColors = {
  hot: '#7aa2ff',
  common: '#6ee7a1',
  signal: '#fcd34d',
  'dry-contact': '#6ee7a1',
  damper: '#fca5a5'
};

// Create nodes with positions
const nodesData = [
  {
    id: 'transformer',
    label: '24VAC Transformer\\n(UPS-backed)',
    x: 88.66,
    y: -124.50,
    group: 'transformer'
  },
  {
    id: 'panel',
    label: 'BMPLUS-3000\\nZone Panel',
    x: 589.71,
    y: 200.89,
    group: 'panel'
  },
  {
    id: 'ecobeeZ1',
    label: 'Ecobee Z1\\n(Enhanced)',
    x: 1182.93,
    y: 30.60,
    group: 'thermostat'
  },
  {
    id: 'ecobeeZ2',
    label: 'Ecobee Z2\\n(Premium)',
    x: 258.20,
    y: 423.58,
    group: 'thermostat'
  },
  {
    id: 'relay',
    label: 'RIBU1C\\nRelay',
    x: 807.16,
    y: 517.62,
    group: 'relay'
  },
  {
    id: 'dehumidifier',
    label: 'GeneralAire\\nDehumidifier',
    x: 1227.93,
    y: 515.53,
    group: 'dehumidifier'
  },
  {
    id: 'damper1',
    label: 'Zone 1 Damper\\n(First Floor)',
    x: 608.66,
    y: -67.03,
    group: 'damper'
  },
  {
    id: 'damper2',
    label: 'Zone 2 Damper\\n(Basement)',
    x: 708.66,
    y: 657.48,
    group: 'damper'
  },
  {
    id: 'equipment',
    label: 'HVAC Equipment\\n(Rheem RP14 + Aux)',
    x: 969.85,
    y: 631.24,
    group: 'equipment'
  }
];

// Define edges (connections) for SVG rendering
const edgesData = [
  // Power distribution
  { from: 'transformer', to: 'panel', label: 'R (24VAC)', color: edgeColors.hot, width: 3, group: 'power' },
  { from: 'transformer', to: 'panel', label: 'C', color: edgeColors.common, width: 3, group: 'power' },
  { from: 'transformer', to: 'ecobeeZ1', label: 'R', color: edgeColors.hot, width: 3, group: 'power' },
  { from: 'transformer', to: 'ecobeeZ1', label: 'C', color: edgeColors.common, width: 3, group: 'power' },
  { from: 'transformer', to: 'ecobeeZ2', label: 'R', color: edgeColors.hot, width: 3, group: 'power' },
  { from: 'transformer', to: 'ecobeeZ2', label: 'C', color: edgeColors.common, width: 3, group: 'power' },
  
  // Ecobee HVAC calls
  { from: 'ecobeeZ1', to: 'panel', label: 'Y1', color: edgeColors.signal, width: 2.5, group: 'cooling' },
  { from: 'ecobeeZ1', to: 'panel', label: 'W1', color: edgeColors.signal, width: 2.5, group: 'heating' },
  { from: 'ecobeeZ2', to: 'panel', label: 'Y1', color: edgeColors.signal, width: 2.5, group: 'cooling' },
  { from: 'ecobeeZ2', to: 'panel', label: 'W1', color: edgeColors.signal, width: 2.5, group: 'heating' },
  
  // Panel to equipment
  { from: 'panel', to: 'equipment', label: 'Y1', color: edgeColors.signal, width: 2.5, group: 'cooling' },
  { from: 'panel', to: 'equipment', label: 'W1', color: edgeColors.signal, width: 2.5, group: 'heating' },
  { from: 'panel', to: 'equipment', label: 'G', color: edgeColors.signal, width: 2.5, group: 'cooling' },
  { from: 'panel', to: 'equipment', label: 'O', color: edgeColors.signal, width: 2.5, group: 'cooling' },
  
  // Dehumidify path
  { from: 'ecobeeZ2', to: 'relay', label: 'ACC+', color: edgeColors.signal, width: 2.5, group: 'dehumidify' },
  { from: 'panel', to: 'relay', label: 'C', color: edgeColors.common, width: 2.5, group: 'dehumidify' },
  { from: 'relay', to: 'dehumidifier', label: 'D1', color: edgeColors['dry-contact'], width: 2.5, dashed: true, group: 'dehumidify' },
  { from: 'relay', to: 'dehumidifier', label: 'D2', color: edgeColors['dry-contact'], width: 2.5, dashed: true, group: 'dehumidify' },
  
  // Zone damper control
  { from: 'panel', to: 'damper1', label: 'M1', color: edgeColors.damper, width: 2.5, group: 'zone1' },
  { from: 'panel', to: 'damper1', label: 'M4', color: edgeColors.damper, width: 2.5, group: 'zone1' },
  { from: 'panel', to: 'damper1', label: 'M6', color: edgeColors.damper, width: 2.5, group: 'zone1' },
  { from: 'panel', to: 'damper2', label: 'M1', color: edgeColors.damper, width: 2.5, group: 'zone2' },
  { from: 'panel', to: 'damper2', label: 'M4', color: edgeColors.damper, width: 2.5, group: 'zone2' }
];

// Initialize SVG network
let svgElement, nodeElements = {}, edgeElements = [];
let viewBox = { x: -200, y: -250, width: 1600, height: 1100 };
let isPanning = false, panStart = { x: 0, y: 0 };

function initializeNetwork() {
  const container = document.getElementById('root');
  container.innerHTML = '';
  
  // Create SVG element
  svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  svgElement.setAttribute('width', '100%');
  svgElement.setAttribute('height', '100%');
  svgElement.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
  svgElement.style.background = '#0b1328';
  container.appendChild(svgElement);
  
  // Draw edges first (so they appear behind nodes)
  edgesData.forEach((edge, idx) => {
    const fromNode = nodesData.find(n => n.id === edge.from);
    const toNode = nodesData.find(n => n.id === edge.to);
    
    if (fromNode && toNode) {
      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', fromNode.x);
      line.setAttribute('y1', fromNode.y);
      line.setAttribute('x2', toNode.x);
      line.setAttribute('y2', toNode.y);
      line.setAttribute('stroke', edge.color);
      line.setAttribute('stroke-width', edge.width);
      if (edge.dashed) {
        line.setAttribute('stroke-dasharray', '5,5');
      }
      line.setAttribute('opacity', '0.8');
      line.dataset.group = edge.group;
      svgElement.appendChild(line);
      edgeElements.push({ element: line, data: edge });
      
      // Add label
      const midX = (fromNode.x + toNode.x) / 2;
      const midY = (fromNode.y + toNode.y) / 2;
      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', midX);
      text.setAttribute('y', midY - 5);
      text.setAttribute('fill', '#e8eefc');
      text.setAttribute('font-size', '10');
      text.setAttribute('text-anchor', 'middle');
      text.textContent = edge.label;
      text.dataset.group = edge.group;
      svgElement.appendChild(text);
      edgeElements.push({ element: text, data: edge });
    }
  });
  
  // Draw nodes
  nodesData.forEach(node => {
    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    g.setAttribute('transform', `translate(${node.x}, ${node.y})`);
    g.dataset.nodeId = node.id;
    g.dataset.group = node.group;
    
    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    rect.setAttribute('x', -60);
    rect.setAttribute('y', -30);
    rect.setAttribute('width', 120);
    rect.setAttribute('height', 60);
    rect.setAttribute('rx', 8);
    rect.setAttribute('fill', nodeColors[node.group]);
    rect.setAttribute('stroke', '#314');
    rect.setAttribute('stroke-width', 2);
    g.appendChild(rect);
    
    const lines = node.label.split('\\n');
    lines.forEach((line, idx) => {
      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      text.setAttribute('x', 0);
      text.setAttribute('y', -10 + (idx * 16));
      text.setAttribute('fill', '#081020');
      text.setAttribute('font-size', node.id === 'panel' ? '14' : '13');
      text.setAttribute('font-weight', 'bold');
      text.setAttribute('text-anchor', 'middle');
      text.setAttribute('dominant-baseline', 'middle');
      text.textContent = line;
      g.appendChild(text);
    });
    
    svgElement.appendChild(g);
    nodeElements[node.id] = g;
  });
  
  // Add pan and zoom
  container.addEventListener('mousedown', startPan);
  container.addEventListener('mousemove', handlePan);
  container.addEventListener('mouseup', endPan);
  container.addEventListener('mouseleave', endPan);
  container.addEventListener('wheel', handleZoom);
}

function startPan(e) {
  if (e.target === svgElement || e.target.tagName === 'svg') {
    isPanning = true;
    panStart = { x: e.clientX, y: e.clientY };
  }
}

function handlePan(e) {
  if (!isPanning) return;
  const dx = (panStart.x - e.clientX) * (viewBox.width / svgElement.clientWidth);
  const dy = (panStart.y - e.clientY) * (viewBox.height / svgElement.clientHeight);
  viewBox.x += dx;
  viewBox.y += dy;
  svgElement.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
  panStart = { x: e.clientX, y: e.clientY };
}

function endPan() {
  isPanning = false;
}

function handleZoom(e) {
  e.preventDefault();
  const scale = e.deltaY > 0 ? 1.1 : 0.9;
  viewBox.width *= scale;
  viewBox.height *= scale;
  svgElement.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
}

// Export layout function
window.exportLayout = function() {
  const layout = {
    components: {},
    edges: []
  };
  
  nodesData.forEach(node => {
    layout.components[node.id] = {
      x: node.x,
      y: node.y,
      type: node.group,
      label: node.label
    };
  });
  
  edgesData.forEach(edge => {
    layout.edges.push({
      from: edge.from,
      to: edge.to,
      label: edge.label,
      group: edge.group
    });
  });
  
  const json = JSON.stringify(layout, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'hvac-network-layout.json';
  a.click();
  URL.revokeObjectURL(url);
  
  console.log("=== Network Layout ===");
  console.log(json);
  alert("Layout exported! Check downloads and console.");
};

// Fit view function
window.fitView = function() {
  viewBox = { x: -200, y: -250, width: 1600, height: 1100 };
  svgElement.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
};

// Highlight path function
window.highlightPath = function(group) {
  // Find nodes in this group
  const highlightNodeIds = new Set();
  edgesData.forEach(edge => {
    if (edge.group === group) {
      highlightNodeIds.add(edge.from);
      highlightNodeIds.add(edge.to);
    }
  });
  
  // Update edges
  edgeElements.forEach(({ element, data }) => {
    if (data.group === group) {
      element.setAttribute('stroke-width', data.width * 2);
      element.setAttribute('stroke', '#fcd34d');
      element.setAttribute('opacity', '1');
    } else {
      element.setAttribute('opacity', '0.2');
    }
  });
  
  // Update nodes
  Object.keys(nodeElements).forEach(nodeId => {
    const node = nodeElements[nodeId];
    if (highlightNodeIds.has(nodeId)) {
      node.setAttribute('opacity', '1');
    } else {
      node.setAttribute('opacity', '0.3');
    }
  });
};

// Reset highlight function
window.resetHighlight = function() {
  // Reset all edges
  edgeElements.forEach(({ element, data }) => {
    const originalColor = data.color;
    element.setAttribute('stroke', originalColor);
    element.setAttribute('stroke-width', data.width);
    element.setAttribute('opacity', '0.8');
  });
  
  // Reset all nodes
  Object.keys(nodeElements).forEach(nodeId => {
    nodeElements[nodeId].setAttribute('opacity', '1');
  });
};

// Setup button handlers and initialize network
document.addEventListener('DOMContentLoaded', () => {
  // Initialize the network
  initializeNetwork();
  
  // Set up button handlers
  document.getElementById('exportBtn').addEventListener('click', window.exportLayout);
  document.getElementById('fitViewBtn').addEventListener('click', window.fitView);
  document.getElementById('highlightDehumid').addEventListener('click', () => window.highlightPath('dehumidify'));
  document.getElementById('highlightCooling').addEventListener('click', () => window.highlightPath('cooling'));
  document.getElementById('highlightHeating').addEventListener('click', () => window.highlightPath('heating'));
  document.getElementById('highlightPower').addEventListener('click', () => window.highlightPath('power'));
  document.getElementById('resetBtn').addEventListener('click', window.resetHighlight);
});
</script>
</body>
</html>
